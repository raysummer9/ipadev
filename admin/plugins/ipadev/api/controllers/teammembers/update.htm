<?= $this->formRender() ?>

<!-- Debug: Check if form is rendered -->
<script>
$(document).ready(function() {
    console.log('Form elements found:', $('input[type="file"]').length);
    console.log('Photo file input:', $('input[name="photo_file"]').length);
    
    // Debug all file inputs
    $('input[type="file"]').each(function(index) {
        console.log('File input ' + index + ':', {
            name: $(this).attr('name'),
            id: $(this).attr('id'),
            class: $(this).attr('class')
        });
    });
    
    // Debug all form fields
    console.log('All form fields:');
    $('input, select, textarea').each(function() {
        console.log('Field:', {
            type: $(this).attr('type'),
            name: $(this).attr('name'),
            id: $(this).attr('id')
        });
    });
    
    // Check if Dropzone is initialized
    console.log('Dropzone elements:', $('.dz-hidden-input').length);
    console.log('File upload containers:', $('.fileupload-container').length);
    
    // Test if file input exists
    if ($('input[name="photo_file"]').length === 0) {
        console.error('Photo file input not found!');
        $('.form-container').prepend('<div class="alert alert-danger">ERROR: Photo file input not found! Check console for actual field names.</div>');
        
        // Try to find the actual file input name
        var fileInput = $('input[type="file"]').first();
        if (fileInput.length > 0) {
            console.log('Found file input but no name. Trying to set name...');
            fileInput.attr('name', 'TeamMember[photo_file]');
        }
    } else {
        console.log('Photo file input found');
    }
    
    // Check for OctoberCMS fileupload widget
    setTimeout(function() {
        console.log('Checking for OctoberCMS fileupload widget...');
        if (typeof $.fn.fileupload !== 'undefined') {
            console.log('OctoberCMS fileupload widget found');
        } else {
            console.error('OctoberCMS fileupload widget not found');
        }
    }, 1000);
});
</script>

<!-- Simple file upload fallback -->
<div class="form-group">
    <label for="simple-photo-upload">Photo Upload (Fallback)</label>
    <input type="file" id="simple-photo-upload" name="TeamMember[photo_file]" accept="image/*" class="form-control">
    <small class="form-text text-muted">Upload a photo for this team member</small>
</div>

<div class="form-buttons">
    <div class="loading-indicator-container">
        <!-- Use regular form submission instead of AJAX for file uploads -->
        <button
            type="submit"
            class="btn btn-primary"
            onclick="submitFormWithFile()">
            Save
        </button>
        <a href="<?= Backend::url('ipadev/api/teammembers') ?>" class="btn btn-default">
            Cancel
        </a>
    </div>
</div>

<script>
function submitFormWithFile() {
    // Get the form
    var form = $('form').first();
    if (form.length === 0) {
        console.error('No form found');
        return;
    }
    
    // Ensure form has multipart encoding
    form.attr('enctype', 'multipart/form-data');
    
    // Get the file input
    var fileInput = $('#simple-photo-upload');
    if (fileInput.length === 0) {
        console.error('File input not found');
        return;
    }
    
    // Check if file is selected
    if (fileInput[0].files.length === 0) {
        console.log('No file selected');
    } else {
        console.log('File selected:', fileInput[0].files[0].name);
    }
    
    // Submit the form normally (not via AJAX)
    form.off('submit'); // Remove any existing submit handlers
    form.submit();
}
</script> 